{% load static %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('IMask script running');
        const phoneInput = document.querySelector('#phone-input');
        console.log('Phone input:', phoneInput);
        if (phoneInput) {
            const mask = IMask(phoneInput, {
                mask: '+{7} (000) 000-00-00',
                lazy: false,
                placeholderChar: '_'
            });
        } else {
            console.error('Phone input not found');
        }
    });

    function openModal() {
        document.getElementById('callbackModal').style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('callbackModal').style.display = 'none';
    }

    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            closeModal();
        }
    });

    document.body.addEventListener('htmx:afterRequest', function(event) {
        if (event.detail.successful) {
            closeModal();
        }
    });
</script>
<div class="callback-modal" id="callbackModal" style="display: none;">
    <div class="callback-modal-backdrop" onclick="closeModal()"></div>
    <div class="callback-modal-content">
        <button class="callback-modal-close" onclick="closeModal()">×</button>
        <h3 class="callback-modal-title">Консультация от специалистов<br><span class="accent">АТК</span></h3>
        <p class="callback-modal-subtitle">Заполните данные, и наши специалисты свяжутся<br>с Вами в ближайшее время.</p>
        <form id="callbackForm" method="post" action="{% url 'core:feedback_form' locality_slug=request.locality.slug %}"
              hx-post="{% url 'core:feedback_form' locality_slug=request.locality.slug %}"
              hx-target="#callbackModal .callback-modal-content"
              hx-swap="innerHTML">
            {% csrf_token %}
            <input type="text" name="name" placeholder="Ваше имя" class="callback-input">
            <input type="tel" name="phone" placeholder="Ваш телефон" required class="callback-input">
            <input type="hidden" name="content" value="Запрос консультации">
            <button type="submit" class="callback-btn">Отправить</button>
            <label class="callback-checkbox">
                <input type="checkbox" required>
                Я согласен с <a href="/privacy/">Политикой конфиденциальности</a> и разрешаю обработку персональных данных
            </label>
        </form>
    </div>
</div>
<script defer src="{% static 'js/imask.min.js' %}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const phoneInput = document.querySelector('[name="phone"]');
        if (phoneInput) {
            const mask = IMask(phoneInput, {
                mask: '+{7} (000) 000-00-00',
                lazy: false,
                placeholderChar: '_'
            });
        }
    });

    function openModal() {
        document.getElementById('callbackModal').style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('callbackModal').style.display = 'none';
    }

    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            closeModal();
        }
    });

    document.body.addEventListener('htmx:afterRequest', function(event) {
        if (event.detail.successful) {
            closeModal();
        }
    });
</script>

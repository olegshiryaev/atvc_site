{% extends "base.html" %}
{% load static %}

{% block title %}Интернет-тарифы{% endblock %}

{% block content %}
<section class="container py-5">
    <h2 class="mb-4">Подключить {{ service.name|lower }} в {{ locality.name_prepositional }}</h2>

    <!-- Блок тарифов -->
    {% include "core/partials/tariffs_list.html" %}

    <!-- Модальное окно -->
    {% include 'core/partials/order_modal.html' %}
</section>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        initOrUpdateSwipers();
    
        // Обновление при переключении табов
        document.querySelectorAll('[data-bs-toggle="tab"]').forEach(btn => {
            btn.addEventListener('shown.bs.tab', () => {
                setTimeout(initOrUpdateSwipers, 50);
            });
        });
    });
    
    let swipers = [];
    
    function initOrUpdateSwipers() {
        document.querySelectorAll('.tariff-swiper').forEach((el) => {
            const wrapper = el.closest('.tariff-swiper-wrapper');
    
            if (!el.swiper) {
                const swiper = new Swiper(el, {
                    slidesPerView: 1,
                    spaceBetween: 20,
                    loop: false,
                    watchOverflow: true,
                    pagination: {
                        el: wrapper.querySelector('.slider-navs__pag'),
                        clickable: true,
                    },
                    navigation: {
                        nextEl: wrapper.querySelector('.slider-navs__next'),
                        prevEl: wrapper.querySelector('.slider-navs__prev'),
                    },
                    breakpoints: {
                        576: { slidesPerView: 1.2 },
                        768: { slidesPerView: 2 },
                        992: { slidesPerView: 3 },
                        1200: { slidesPerView: 4 },
                    },
                    on: {
                        init: function () {
                            // Показать стрелки только после инициализации
                            wrapper.classList.add('swiper-ready');
                        }
                    }
                });
                swipers.push(swiper);
            } else {
                el.swiper.update();
            }
        });
    }
</script>
{% endblock %}